(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["003cd385"],{aa3c57cd:function(e,a,s){s.d(a,"__esModule",{value:!0}),s.e(a,{default:function(){return D;}});var t=s("777fffbe"),r=s("852bbaa9"),d=s("6ac60d67"),o=s("2f16c0fe"),n=r._(o),i=s("45b35e13"),l=s("fe1f6fec"),c=s("05cbd9ef"),u=t._(c),m=s("edb6e4c7"),f=t._(m),p=s("04d1c651"),h=t._(p),y=s("f28f50f3"),g=s("b4e2f04e"),x=t._(g),b=s("ef1d6174"),j=t._(b),v=s("7f8b5f84"),T=t._(v),I=s("64265f49"),k=t._(I);let _=async e=>(0,y.request)("/api/sys/role/list",{method:"POST",data:e}),q=async e=>(0,y.request)("/api/sys/role/info",{method:"GET",params:{id:e}}),M=async e=>(0,y.request)("/api/sys/role/add",{method:"POST",data:e}),S=async e=>(0,y.request)("/api/sys/role/update",{method:"POST",data:e}),P=async e=>(0,y.request)("/api/sys/role/delete",{method:"GET",params:{id:e.id}}),w=async()=>(0,y.request)("/api/sys/role/resource",{method:"GET"}),C=async e=>(0,y.request)("/api/sys/role-resource/permission",{method:"GET",params:{roleId:e.id}}),O=async e=>(0,y.request)("/api/sys/role-resource/save",{method:"POST",data:{roleId:e.id,resourceIds:e.resourceIds}}),E=e=>{let{id:a,open:s,setOpen:t,onSuccess:r}=e,[o]=j.default.useForm(),n=(0,y.useIntl)();return(0,d.jsxs)(x.default,{request:async e=>q(e),id:a,open:s,setOpen:t,onSuccess:async e=>(a?await S(e):await M(e),r(),!0),form:o,children:[(0,d.jsx)(T.default,{name:"id",hidden:!0}),(0,d.jsx)(T.default,{name:"name",label:n.formatMessage({id:"pages.common.name"}),rules:[{required:!0}]}),(0,d.jsx)(T.default,{name:"sortNum",label:n.formatMessage({id:"pages.common.sort.number"}),rules:[{required:!0}]}),(0,d.jsx)(k.default,{name:"description",label:n.formatMessage({id:"pages.common.description"}),fieldProps:{maxLength:1024,showCount:!0}})]});};var F=s("3c0f5305"),G=t._(F),R=s("84ab8c32"),K=s("b9d6b1ca"),A=t._(K);let N=(e,a,s)=>{for(let t of e)if(t.children&&t.children.length>0){let e=a.indexOf(t.id);if(e>=0){let t=a.splice(e,1);s.push(...t);}N(t.children,a,s);}},B=e=>{let{id:a,open:s,setOpen:t,onSuccess:r}=e,[o]=j.default.useForm(),i=(0,y.useIntl)(),[l,c]=(0,n.useState)([]),[u,m]=(0,n.useState)([]),[p,h]=(0,n.useState)([]);return(0,d.jsx)(x.default,{open:s,setOpen:t,id:a,request:async e=>{let s=async()=>{let e=(await w()).data;if(a){let s=await C({id:a}),t=[];c(e),N(e,s.data,t),m(s.data),h(t);}else c(e);};await s();},onSuccess:async()=>{let{code:e,message:s}=await O({id:a,resourceIds:[...u,...p]});return 200!==e?(f.default.error(s),!1):(f.default.success(s),r(),!0);},form:o,children:(0,d.jsx)(R.ProForm.Item,{name:"resourceIds",valuePropName:"resourceIds",label:i.formatMessage({id:"pages.sys.resource.name"}),rules:[{required:!0,validator:async()=>0===u.length?Promise.reject(Error(i.formatMessage({id:"pages.sys.resource.required"}))):Promise.resolve()}],children:(0,d.jsx)(A.default,{checkable:!0,treeData:l,checkedKeys:u,onCheck:(e,a)=>{"Resource_Type_Permission"===a.node.type&&"Write"===a.node.name&&a.checked?m([...e,a.node.parentId+"",a.node.key]):m(e),h(a.halfCheckedKeys);}})})});},D=()=>{let e=(0,y.useIntl)(),[a,s]=(0,n.useState)(!1),[t,r]=(0,n.useState)(!1),[o,c]=(0,n.useState)(void 0),m=(0,n.useRef)(),p=(0,y.useAccess)()[y.history.location.pathname],g=[{title:e.formatMessage({id:"pages.common.name"}),dataIndex:"name",valueType:"text"},{title:e.formatMessage({id:"pages.common.description"}),dataIndex:"description",valueType:"text"},{title:e.formatMessage({id:"pages.common.createTime"}),dataIndex:"createAt",valueType:"dateTime",hideInSearch:!0},{title:e.formatMessage({id:"pages.common.option"}),dataIndex:"option",valueType:"option",fixed:"right",render:(a,t)=>p&&[(0,d.jsx)(u.default,{type:"link",onClick:()=>{c(t.id),s(!0);},children:e.formatMessage({id:"pages.common.edit"})},"editable"),(0,d.jsx)(u.default,{type:"link",onClick:()=>{c(t.id),r(!0);},children:e.formatMessage({id:"pages.sys.auth.role.resource"})},"auth"),(0,d.jsx)(h.default,{title:e.formatMessage({id:"pages.confirm.delete"}),onConfirm:async()=>{var e;let{code:a,message:s}=await P(t);200===a?f.default.success(s):f.default.error(s),null===(e=m.current)||void 0===e||e.reload();},children:(0,d.jsx)(u.default,{type:"link",children:e.formatMessage({id:"pages.common.delete"})},"delete")},"delete")]}];return(0,d.jsxs)(i.PageContainer,{children:[(0,d.jsx)(l.ProTable,{toolBarRender:()=>p&&[(0,d.jsx)(u.default,{icon:(0,d.jsx)(G.default,{}),type:"primary",onClick:()=>{c(void 0),s(!0);},children:(0,d.jsx)(y.FormattedMessage,{id:"pages.common.new"})},"button")],actionRef:m,request:async e=>_(e),columns:g,rowKey:"id"}),(0,d.jsx)(E,{id:o,open:a,setOpen:s,onSuccess:()=>{var e;c(void 0),null===(e=m.current)||void 0===e||e.reload();}}),(0,d.jsx)(B,{id:o,open:t,setOpen:e=>{e||c(void 0),r(e);},onSuccess:()=>{c(void 0);}})]});};}}]);
//# sourceMappingURL=003cd385-async.dc1ba8ee.js.map